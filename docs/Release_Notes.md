
# Release Notes

 - **v1.4.0** - 2019/11/**
   - ちなみに 1.4.0 みたいなバージョンは メジャーバージョンアップ（機能追加がほとんど）です
   - 1.2.1 みたいなバージョンは マイナーバージョンアップ（不具合修正多め）と分けてるつもり
   - **VCEEncC でのエンコードに対応した**
     - VCE の仕様でインタレ解除が出来ないらしいですが rigaya さんが最近の QSVEncC 等の変更に合わせて 5.00 をリリースしていたので対応する事ができました
       - いつも本当にありがとうございます…
     - こちらに VCE が使える環境があるわけではないので、動くかは微妙です…（フィードバックいただけると助かります）
   - **MKV ファイルの再生に対応した**
     - MKV で再生させてる方が結構多そうなので対応するだけしてみました
     - プログレッシブダウンロードで再生する場合、ブラウザで再生出来るコーデックは限られるため、例えば H.265 でエンコードしたファイルの場合は Chrome では音声しか再生されません
       - 適宜普通にエンコードして再生させるなりしてください（丸投げ）
   - **MKV ファイルのダウンロードに対応した**
     - 再生対応の完全についでです
   - **DPlayer（動画プレイヤー）を更新**
     - スマホで設定画面の高さがおかしくなる不具合を修正しました
     - あとはスタイル調整とか
   - **タブを BS か CS にしたときにブラウザバー開閉でタブがおかしくなる不具合を修正**
     - 一旦 destoroy() したらうまく行ったことに気づいてしまった
     - ついででブラウザバー開閉で何度も resize イベントが発火して重い処理をやろうとするのを避けるようにした
       - 実際に軽くなってるのかは微妙
     - ブラウザのキャッシュを完全に消してからリロードしてみてください
   - **Mac で Option キー + 1 などのショートカットを使うと！を反対にした謎の文字が一緒に入ってしまう不具合を修正**
     - preventDefault() してなかっただけ閉廷
   - **セレクトボックス周りの変更**
     - アイコンが開閉するのは不具合が多かったので上下アイコンに変えました…
   - **TSTask に Theme ファイルを追加した**
     - すっかり同梱するの忘れてました…
   - **Apache を 2.4.41 に更新**
     - リリース時から一度もアップデートしていなかったため一気にやってしまいました
     - 設定やファイル等カスタムしているので数時間かけてようやく…
   - **PHP を 7.3.12 に更新**
     - 7.3.12 にしたら変なファイルが増えてたのでごっそり消しときました（配布サイズ対策）
   - **TwitterOAuth を更新**
     - 別件でちょっと弄ったのでそのついで
   - QSVEncC を 3.27 に更新
   - NVEncC を 4.55 に更新
   - デフォルトの設定内容をちょっと変更
   - りどみが雑になってたので整理
   - その他スタイル調整・コード整理など

 - **v1.3.1** - 2019/11/**（幻）
   - **再生履歴が表示できなくなっていた問題を修正**
     - アップデートする前に一度 (TVRemotePlus)/htdocs/files/history.json を削除してください

 - **v1.3.0** - 2019/11/03
   - システムの根幹（特にファイル再生周り）にかなり手を加えた大幅なアップデートとなっています
   - **アップデートの際の諸注意**
     - 録画ファイルリストのフォーマットが変更されているため、一度「リストをリセット」からリストをリセットし、もう一度リストを生成し直してください
     - (TVRemotePlus)/htdocs/files/info/ フォルダは廃止されました
       - アップデート時に手動でフォルダごと削除してください
     - API の名前が変更になりました
       - アップデート後に残る (TVRemotePlus)/htdocs/api/ フォルダ内の下記フォルダを手動で削除してください
         - epgguide.php
         - jkapi.php
         - searchfile.php
         - watchnow.php
       - また、リバースプロキシを利用している場合は、Apache 等の Web サーバーの設定ファイルも適宜書き換えてください
         - 詳しくは [Reverse_Proxy.md](Reverse_Proxy.md) を参照してください
     - 以前のバージョンのキャッシュがブラウザに残っていると、正常に動作しない可能性があります
       - 必ずブラウザのキャッシュを削除してからアクセスしてください
   - **MP4 ファイルの再生に対応した**
     - 以前から要望があった機能なのですが、ようやく実装できました…
     - また、MP4 ファイルであれば TS のように一々エンコードする必要はないため、ついでにプログレッシブダウンロードにも対応しました（ MP4 ファイルのみ）
       - プログレッシブダウンロードは、要は元の MP4 ファイルをそのまま再生させる方式のことです
       - 元の MP4 ファイルそのままの画質で再生できます
       - エンコードを行わないため、最初から最後まですぐに再生できます
       - 回線が遅いなどの事情がない限り、MP4 ファイルを再生する場合はプログレッシブダウンロードで再生する事をおすすめします
       - MP4 ファイル再生時はデフォルト値をプログレッシブダウンロードに設定します
     - MP4 ファイルでは番組情報が取得できないため、同じファイル名のTSファイルがあればその番組情報を借用するようにしました
       - 同じファイル名の TS ファイルがない場合、番組情報が取得できないため、ファイル名と更新時刻から推測して表示します
     - 現状、MP4 ファイルの再生時には字幕はオン・オフに関わらず表示されません
       - MP4ファイル自体に字幕が含まれていないためです
       - 将来的には同じファイル名で字幕ファイルが置いてあれば変換して表示できるようにしたいと考えています
   - **MP4 ファイルのダウンロードに対応した**
     - ついでで MP4 ファイルのダウンロードにも対応しました
     - MP4 ファイルのサムネイルにマウスをかざすか、タッチデバイスであればサムネイルをタップするとダウンロードボタンが表示されるので、それをクリック or タップするとダウンロードされます
     - 持ち出し用のスマホやタブレットに予めエンコードしておいた動画をダウンロードしておいて出先で見る、といった使い方ができると思います
     - TS ファイルはあまりにもファイルサイズが巨大な上、スマホではうまく再生できないプレイヤーが多いため、ダウンロードには非対応としています
     - 後日 TS ファイルの MP4 ファイルへのエンコード機能も実装予定です
   - **リスト更新を大幅に高速化した**
     - 遅い遅いと言われていたリスト更新の処理ですが、大幅に高速化しました
     - 遅くなっていた原因ですが、録画ファイルのあるフォルダ内にスクランブル解除に失敗した TS ファイルなどの再生できないファイルがあった場合に、30秒ほど試行した後サムネイル生成に失敗するのにも関わらず毎回生成させていたためでした…
     - サムネイル生成に一度失敗したらそれ以降サムネイルの生成を行わないようにする事で、処理を大幅に高速化する事ができました
     - 毎回2～3分かかっていたリスト更新が1番組あたり4秒程度で更新できるようになりました
   - **API 周りの変更**
     - 前述の通り、API ファイルの名前が変更になりました
     - epgguide.php → epginfo.php
     - jkapi.php → jikkyo.php
     - searchfile.php → listupdate.php
     - watchnow.php → status.php
     - 前からガバガバ英語なのと分かりづらいのと主な役目が変わってしまったAPIがあったりで名前を変えたいと思っていました
     - また、.php なしで API にアクセスするようになりました
       - 例： https://192.168.1.11:8100/api/listupdate?flush
       - この方が URL の見た目がきれいなはず…
   - **Android 版 Chrome にて Picture-in-Picture (PiP) に対応した**
     - 今まで Android 版 Chrome では JavaScript からピクチャーインピクチャーを呼び出す事が出来なかったのですが、Chrome78 より実装されたみたいです
     - 今までも全画面にした後ホームボタンを押す事で PiP モードにする事は可能でしたが、これからはプレイヤーのボタンを押すだけで PiP モードに移れるようになります
     - 「何か調べ物をしながらテレビを見る」など、いろいろ活用できると思います
     - ただし、古い Android（8.0以前…？）では OS 側が非対応のため表示できない場合があります
     - その他 PiP ボタンを追加するにあたりアイコンの位置・サイズ調整等も行いました
   - **インストーラーでの証明書生成を自動で生成できるようにした**
     - 今までの Enter 連打が必要なくなります
     - 証明書生成に失敗する環境があるらしいのですが、こちらでは生成できているので原因がよくわかっていません…
   - **ストリーム開始時のコマンドを表示できるようにした**
     - ストリーム開始時の ffmpeg や QSVEncC といったエンコード用ソフトの起動用コマンドを表示できます（ほぼほぼデバッグ用）
     - 表示させる場合は、環境設定の下の方の「ストリーム開始設定後の画面を表示せずに再生画面へリダイレクトする」をオフにしてください
   - **1080p 以外の画質で再生させた場合にアスペクト比が歪む問題を修正**
     - 前回のアップデートの弊害でした…
     - 1080p とそれ以外の画質でエンコード時のピクセルアスペクト比を分ける事で修正しました
   - **一部のチャンネルの実況勢いが表示されない問題を修正**
     - ch_sid.txt 内のチャンネル名と実際のチャンネル名が異なるケースが複数出てきています
     - 他にも実況勢いが表示されないチャンネルがあれば 5ch の方で報告していただけると助かります
   - 録画ファイルを検索後「もっと見る」をクリックすると一番上までスクロールされてしまう不具合を修正
     - ファイル再生周りをかなり改修したのでそのついでです
   - ニコニコ実況のコメントと字幕が同時にキャプチャ画像に含まれている際に合成する順番が逆なのを修正
   - NVEncC を更新
   - その他バグ修正・微調整・スタイル調整など…

 - **v1.2.2** - 2019/10/11
   - 台風で停電しそうなので早めにうｐ
   - **CH2ファイルが BonDriver_Spinel_T01_MyPC.ch2 のようなファイル名の場合にチャンネル設定ファイルがうまく取得出来ない不具合を修正**
     - 元々 BonDriver_Spinel_T1.ch2 のようなファイル名を想定していたのですが、T01 のように 2 桁にしている方や T01_MyPC のように PC 名を付けている方もいたようで…（本当は統一してほしいところなんですが）
     - ついでに BonDriver の dll の方もそのようなファイル名になっていても検出出来るようにしました
   - **コメントの遅延時間を個人設定から指定出来るようにした**
     - 0 ～ 60（秒）の範囲で指定できます
     - 個人設定は端末ごとに反映されます。注意してください。
   - **1080p で配信した場合、BS11 など 1920×1080 で放送されている局で 4:3 の比になってしまう不具合を修正**
     - アスペクト比を指定してなかったのが原因っぽいです…
   - **Mac 版 Chrome でコメント付きでキャプチャした場合にフォントが明朝体になってしまう不具合を修正**
     - なぜ sans-serif と指定しているのに serif 体になってしまうのかは謎…（ Mac のバグでは🤔）
   - **初回インストール時に初期設定に関わらず配信休止中…の音楽が流れてしまう不具合を修正**
    - 多分治ってると思います（思いたい）
   - その他軽微な修正

 - **v1.2.1** - 2019/10/03
   - **Twitter にログインしているアカウントを確認できるようにした**
     - PC の場合は青い鳥アイコンにマウスをかざすと、スマホ・タブレットの場合は青い鳥アイコンをタップすると表示されます
     - v1.2.1 以前から Twitter にログインしていた場合は「ログインしていません」と表示されます、正しく表示させる場合はもう一度ログインし直してください
   - **CBC テレビとメ～テレの実況勢い・コメントが表示されない不具合を修正**
     - メ～テレに関しては全角チルダと波ダッシュの文字コードの違いが原因でした… どうにかしろよMS（無理）
   - Font Awesome を v5.11.2 に更新
   - スタイルの微修正

 - **v1.2.0** - 2019/09/26
   - **画質設定に 1080p（1440×1080）を追加した**
     - 地デジと BS の殆どの局では 1440×1080 で放送されているので、サイズを抑えながら普通に見るのと変わらない画質で視聴できます
     - 以前の 1080p だとどうしてもスマホなどの低スペック端末ではストリームがカクつく事があったのですが、1440×1080 であればセグメントのダウンロード時間を 1920×1080 よりも低く抑えられるため、より高画質でカクつかずに再生できるようになっていると思います
     - 特に Chromecast 再生時や大画面ディスプレイでの再生時に違いが良く出るような気がします
     - これに伴い、インストール時のデフォルト画質を 1080p に変更した他、以前の 1080p（1920×1080）は　1080p-high という扱いとしました
   - **地デジと BS・CS の混合チューナーに対応した**
     - 前々から色々な方に要望されていたのですが、ようやく実装しました
     - こちらに混合チューナーの環境がないので動くかどうか微妙…
     - 地デジと BS・CS 双方を同じ BonDriver で再生させる場合は、設定ページの BonDriver のデフォルト設定を（地デジ用）・（BS・CS用）どちらとも同じ BonDriver を指定して下さい
     - これに伴い、BonDriver フォルダに無印（ T0 や S0 が付いていない）BonDriver があればそれも選べるようにしました
     - ついでに UTF-16LE（BOM 付き）がうまく読み込めず一部チャンネルの実況勢いが表示されない不具合も修正しました
   - **Chromecast キャスト機能を大幅に改善**
     - 今回のアップデートのメインです（3日ぶっ通しでようやく…）
     - **PC・Android の Chrome かつ https でアクセスしている場合に Chrome ネイティブ機能でキャストするようにした**
       - 情報が不親切な英語ドキュメントしかなくてかなり大変でした…
       - http アクセスだと動かないのでネイティブ機能を使う場合は（予め PWA 用の証明書を端末にインストールした上で）https でアクセスしてください
       - これにより Chromecast と 手元のプレイヤーの再生位置が綺麗に同期されるようになります（中々同期出来ず大変でした…）
       - JavaScript からのキャストは（当然ながら）Chrome 以外のブラウザでは使えないので今まで通りの方法でキャスト出来るようにしました
       - iOS 版 Chrome は対応してるのかしてないのか良く分からないので当面は他ブラウザ同様の対応としました
     - 今までの方もネイティブ機能に合わせ動作等を改善しました
     - あと Chromecast でなくても Google Cast に対応している製品（ AndroidTV だとか GoogleHome だとか GoogleNestHub だとか）であれば同様にキャスト出来るはずです
   - プレイヤー周り
     - **TVRemotePlus で使用している動画プレイヤー（DPlayer）を最新版に更新した**
     - **Android スマートフォンでの再生時にフルスクリーンにした場合画面を横に回転するようにした**
       - iPhone・iPad はそもそもフルスクリーン API が極めて限定的対応かつ Screen Orientation API 非対応なので無理です
     - たまに動画のシーク時にプレイヤーが再生と停止を繰り返してバグる不具合を修正・その他シーク周りの改善
     - コメント描画のさらなる高速化
       - 本当はこれ以上高速化したい（特にスマホ）んですがもう限界そう…（最初の頃と比べれば大分カクつかなくなったし…）
       - 実験台にしてるスマホがミドルレンジだししょうがないね
   - 再生ページのロード時の動作を高速化
   - スタイルの調整
   - NVEncC を 4.50 に更新
   - その他不具合修正など… 

 - **v1.1.0** - 2019/09/13
   - **新規機能の追加はあまりありませんが、ほぼ全てのファイルを修正したのでメジャーバージョンアップです**
   - 諸々不具合が修正されていると思います
   - コメントのフォントサイズをある程度変えられるようにした
     - プレイヤーのコア部分を弄ったので疲れました…
   - ファイル再生時に字幕をストリームに含めるかどうか設定できるようにした
     - ごく稀に字幕をストリームに含めると途中でエンコードに失敗してしまう録画があるためです
     - デフォルトはオンになっています、問題があった時のみオフにすることをおすすめします
   - TVRemoteViewer での番組表取得に関する情報を追記
   - コメント一覧をスクロールしている時に新しいコメントが来ると強制で下にスクロールされてしまう不具合を修正
     - 色々悩みましたが、結局 YouTube Live っぽい仕様にしました
   - 生放送時に一時停止した状態にするとコメントが溜まりに溜まる不具合を修正
   - ニコニコ実況がメンテナンスの際にメンテナンス表示を出すようにした
     - 丁度最近メンテナンスがあったのでそのついでです
   - ニコニコ実況の過去ログ取得時にコメントが多すぎる（例：ラピュタ）と実行時間制限を超えてタイムアウトしコメントが取得できない不具合を修正
     - 正直ラピュタレベルはコメントが多すぎてまともに再生できませんでした…（Canvasにしたほうが大量のコメントには強いんでしょうけど、改造元のプレイヤーがCSSアニメーションで実現させる方式のためどうしてもコメントが多くなるとかなり重くなってしまいます）
   - iOS 環境でファイル再生時にシークが出来ない（バー自体が出ない）不具合を修正
     - Safari の仕様で HLS ストリーミング再生時は video.duration が取得出来ないらしく、こちらもプレイヤーのコア部分を大幅に弄ったので疲れました
   - スマホなどのタッチデバイスでのシーク時に再生させながらシークしようとするとシークバーが荒ぶる不具合を修正
     - シーク中は一旦動画を一時停止させるようにしました
     - これもプレイヤーのコア部分を大幅ｎ（ｒｙ
   - 個人設定が数日で切れてしまう不具合を修正
     - Cookie の有効期限を365日にしました
   - 個人設定の読み込みに失敗する不具合を修正
   - スマホで見た際にヘッダーのロゴを中央寄せするようにした
   - ヘッダーのアイコンにマウスをかざした際に丸くホバーするようにした
   - 右上のサブメニュー周りの変更
     - サブメニューを閉じる際に透明な要素を置いて何もないところをクリックしたら変な所を押しちゃった、という事がないようにした
     - サブメニューが引っ込まない不具合を修正した
   - Twitter ログインの有効期限を1週間から3ヶ月に変更
     - 上の Cookie 有効期限変更のついでです
   - 絶対パスに変更しきれていなかった部分の変更
   - 全体的な速度の高速化
   - CSS レイアウト（見た目）の調整
   - 肥大化したコードを大幅に整理
   - インストーラーの微修正
   - ffmpeg.exe → ffmpeg-tvrp.exe・QSVEncC64.exe → QSVEncC64-tvrp.exe・NVEncC64.exe → NVEncC64-tvrp.exe にそれぞれ名前を変更
     - TVRemotePlus 側で他に起動している各 exe のプロセスを謝って全て kill しないための暫定処置です
   - NVEncC を 4.47 に更新
   - リリースノートを書くようにした
     - 毎回変更点が多くて作業してると何をアップデートしたか忘れるためです…
   - その他細かな不具合の修正を山程…

 - **v1.0.2** - 2019/08/30
   - ストリームの画質を向上
   - Chromecast キャスト機能の動作を修正
   - 設定が反映できない不具合を修正
   - その他不具合修正のみです

 - **v1.0.1** - 2019/08/29
   - **コメント描画、サイドメニュー開閉などの随所で使われているアニメーションの大幅な高速化**
     - フロントエンド部分は全て jQuery で書いていたのですが jQuery 自体がかなり遅く、0.5秒ごとなどに実行する処理にしては重すぎたので定期的に実行する処理はピュアJavaScriptで書き直しました
     - animate() は Velocity.js で置き換えました
     - PCだとよくわからないと思いますが、特にローエンドの Android などで今までカクついていたコメントが大分ましになっていると思います（スペックによりますが）
     - **また、プレイヤーの設定→コメントを無制限に表示 をオフにすると、生放送時で0.5秒ごとに実行するコメント取得処理時に一度に描画するコメントを8個に制限します**
       - 金曜ロードショーなど、実況勢いが200を超えるような番組で効果を発揮します
       - **低スペックPCやスマホではこの設定をオフにしておくことをお勧めします**
   - BonDriverチャンネル設定ファイル(.ch2)の取得処理の変更
     - 今まで認識出来ていた.ch2は概ね認識できると思います(思いたい)
     - **BonDriver_FSUSB2N.ch2 などのファイル名の場合、地上波用かBS・CS用か認識できません**
     - 必ず地上波用であれば BonDriver_FSUSB2N_T.ch2・BS・CS用であれば BonDriver_FSUSB2N_S.ch2 のように、ファイル名の最後に T(0-9)かS(0-9)を付けるようにしてください
   - ファイル再生画面の更新時にフェードを掛けるようにした
     - 今までより綺麗だと思います
   - Firefoxにてブックマークから開いた場合に地デジ・BS・CS切り替えタブが機能しない問題を改善
   - インストーラーで予め録画ファイルのあるフォルダを設定出来るようにした
   - Chromecast機能が動かない問題を修正
   - Chromecast機能の再生/停止関連の動作を一部修正
     - 操作の遅延が少なくなると思います
   - ファイル再生画面でリストがない場合にエラーになる問題を修正
   - ストリーム再起動が重複する問題を修正
   - その他不具合修正諸々


 - **v1.0.0** - 2019/08/27
   - **ついに正式版になりました！**（いつまでもRC版できりがなさそうなので…）
   - 環境設定設定を設定ページから変更できるようにした
     - これで config.php を一々いじる必要がなくなる他、設定ミスで文法エラーが起きることもなくなり非常に使いやすくなると思います
   - 録画ファイル増減時にリストを自動で更新するようにした
   - 地デジのチャンネルに BonDriver_*S0.dll などBSCS用BonDriverを、BSCSのチャンネルに BonDriver_*T0.dll などを表示しないようにした
     - 設定ページを作るにあたり不都合になったので一緒に修正しました
   - ストリームが途中で止まってしまった場合に20秒以上ストリームの更新がない事を検知してストリームを再起動するようにした
   - ストリーム開始して30秒以上音沙汰がなければ失敗したと判定して自動でストリーム終了するようにした
   - ファイル再生画面の画面描画時にフェードアニメーションを追加
   - ←キーで5秒巻き戻し・→キーで5秒早送り・スペースキーで再生/停止、(プレイヤーにフォーカスが当たっている状態で)↑キーで音量+・↓キーで音量- が出来るようにした
     - 実際はもっと前から出来たのですが、あまり認知されていなかったのと動作が微妙だったのでまとめて修正しました
   - Twitter ログイン時に Consumer Key 等が間違っていて認証に失敗した際にエラーメッセージを出すようにした
   - サイドメニューのバージョン欄を version 1.0.0 のように表示するようにした
   - アイコンの更新
   - その他諸々の不具合修正