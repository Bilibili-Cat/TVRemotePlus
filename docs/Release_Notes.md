
# Release Notes

 - **v1.2.2** - 2019/10/11
   - 台風で停電しそうなので早めにうｐ
   - **CH2ファイルが BonDriver_Spinel_T01_MyPC.ch2 のようなファイル名の場合にチャンネル設定ファイルがうまく取得出来ない不具合を修正**
     - 元々 BonDriver_Spinel_T1.ch2 のようなファイル名を想定していたのですが、T01 のように 2 桁にしている方や T01_MyPC のように PC 名を付けている方もいたようで…（本当は統一してほしいところなんですが）
     - ついでに BonDriver の dll の方もそのようなファイル名になっていても検出出来るようにしました
   - **コメントの遅延時間を個人設定から指定出来るようにした**
     - 0 ～ 60（秒）の範囲で指定できます
     - 個人設定は端末ごとに反映されます。注意してください。
   - **1080p で配信した場合、BS11 など 1920×1080 で放送されている局で 4:3 の比になってしまう不具合を修正**
     - アスペクト比を指定してなかったのが原因っぽいです…
   - **Mac 版 Chrome でコメント付きでキャプチャした場合にフォントが明朝体になってしまう不具合を修正**
     - なぜ sans-serif と指定しているのに serif 体になってしまうのかは謎…（ Mac のバグでは🤔）
   - その他軽微な修正

 - **v1.2.1** - 2019/10/03
   - **Twitter にログインしているアカウントを確認できるようにした**
     - PC の場合は青い鳥アイコンにマウスをかざすと、スマホ・タブレットの場合は青い鳥アイコンをタップすると表示されます
     - v1.2.1 以前から Twitter にログインしていた場合は「ログインしていません」と表示されます、正しく表示させる場合はもう一度ログインし直してください
   - **CBC テレビとメ～テレの実況勢い・コメントが表示されない不具合を修正**
     - メ～テレに関しては全角チルダと波ダッシュの文字コードの違いが原因でした… どうにかしろよMS（無理）
   - Font Awesome を v5.11.2 に更新
   - スタイルの微修正

 - **v1.2.0** - 2019/09/26
   - **画質設定に 1080p（1440×1080）を追加した**
     - 地デジと BS の殆どの局では 1440×1080 で放送されているので、サイズを抑えながら普通に見るのと変わらない画質で視聴できます
     - 以前の 1080p だとどうしてもスマホなどの低スペック端末ではストリームがカクつく事があったのですが、1440×1080 であればセグメントのダウンロード時間を 1920×1080 よりも低く抑えられるため、より高画質でカクつかずに再生できるようになっていると思います
     - 特に Chromecast 再生時や大画面ディスプレイでの再生時に違いが良く出るような気がします
     - これに伴い、インストール時のデフォルト画質を 1080p に変更した他、以前の 1080p（1920×1080）は　1080p-high という扱いとしました
   - **地デジと BS・CS の混合チューナーに対応した**
     - 前々から色々な方に要望されていたのですが、ようやく実装しました
     - こちらに混合チューナーの環境がないので動くかどうか微妙…
     - 地デジと BS・CS 双方を同じ BonDriver で再生させる場合は、設定ページの BonDriver のデフォルト設定を（地デジ用）・（BS・CS用）どちらとも同じ BonDriver を指定して下さい
     - これに伴い、BonDriver フォルダに無印（ T0 や S0 が付いていない）BonDriver があればそれも選べるようにしました
     - ついでに UTF-16LE（BOM 付き）がうまく読み込めず一部チャンネルの実況勢いが表示されない不具合も修正しました
   - **Chromecast キャスト機能を大幅に改善**
     - 今回のアップデートのメインです（3日ぶっ通しでようやく…）
     - **PC・Android の Chrome かつ https でアクセスしている場合に Chrome ネイティブ機能でキャストするようにした**
       - 情報が不親切な英語ドキュメントしかなくてかなり大変でした…
       - http アクセスだと動かないのでネイティブ機能を使う場合は（予め PWA 用の証明書を端末にインストールした上で）https でアクセスしてください
       - これにより Chromecast と 手元のプレイヤーの再生位置が綺麗に同期されるようになります（中々同期出来ず大変でした…）
       - JavaScript からのキャストは（当然ながら）Chrome 以外のブラウザでは使えないので今まで通りの方法でキャスト出来るようにしました
       - iOS 版 Chrome は対応してるのかしてないのか良く分からないので当面は他ブラウザ同様の対応としました
     - 今までの方もネイティブ機能に合わせ動作等を改善しました
     - あと Chromecast でなくても Google Cast に対応している製品（ AndroidTV だとか GoogleHome だとか GoogleNestHub だとか）であれば同様にキャスト出来るはずです
   - プレイヤー周り
     - **TVRemotePlus で使用している動画プレイヤー（DPlayer）を最新版に更新した**
     - **Android スマートフォンでの再生時にフルスクリーンにした場合画面を横に回転するようにした**
       - iPhone・iPad はそもそもフルスクリーン API が極めて限定的対応かつ Screen Orientation API 非対応なので無理です
     - たまに動画のシーク時にプレイヤーが再生と停止を繰り返してバグる不具合を修正・その他シーク周りの改善
     - コメント描画のさらなる高速化
       - 本当はこれ以上高速化したい（特にスマホ）んですがもう限界そう…（最初の頃と比べれば大分カクつかなくなったし…）
       - 実験台にしてるスマホがミドルレンジだししょうがないね
   - 再生ページのロード時の動作を高速化
   - スタイルの調整
   - NVEncC を 4.50 に更新
   - その他不具合修正など… 

 - **v1.1.0** - 2019/09/13
   - **新規機能の追加はあまりありませんが、ほぼ全てのファイルを修正したのでメジャーバージョンアップです**
   - 諸々不具合が修正されていると思います
   - コメントのフォントサイズをある程度変えられるようにした
     - プレイヤーのコア部分を弄ったので疲れました…
   - ファイル再生時に字幕をストリームに含めるかどうか設定できるようにした
     - ごく稀に字幕をストリームに含めると途中でエンコードに失敗してしまう録画があるためです
     - デフォルトはオンになっています、問題があった時のみオフにすることをおすすめします
   - TVRemoteViewer での番組表取得に関する情報を追記
   - コメント一覧をスクロールしている時に新しいコメントが来ると強制で下にスクロールされてしまう不具合を修正
     - 色々悩みましたが、結局 YouTube Live っぽい仕様にしました
   - 生放送時に一時停止した状態にするとコメントが溜まりに溜まる不具合を修正
   - ニコニコ実況がメンテナンスの際にメンテナンス表示を出すようにした
     - 丁度最近メンテナンスがあったのでそのついでです
   - ニコニコ実況の過去ログ取得時にコメントが多すぎる（例：ラピュタ）と実行時間制限を超えてタイムアウトしコメントが取得できない不具合を修正
     - 正直ラピュタレベルはコメントが多すぎてまともに再生できませんでした…（Canvasにしたほうが大量のコメントには強いんでしょうけど、改造元のプレイヤーがCSSアニメーションで実現させる方式のためどうしてもコメントが多くなるとかなり重くなってしまいます）
   - iOS 環境でファイル再生時にシークが出来ない（バー自体が出ない）不具合を修正
     - Safari の仕様で HLS ストリーミング再生時は video.duration が取得出来ないらしく、こちらもプレイヤーのコア部分を大幅に弄ったので疲れました
   - スマホなどのタッチデバイスでのシーク時に再生させながらシークしようとするとシークバーが荒ぶる不具合を修正
     - シーク中は一旦動画を一時停止させるようにしました
     - これもプレイヤーのコア部分を大幅ｎ（ｒｙ
   - 個人設定が数日で切れてしまう不具合を修正
     - Cookie の有効期限を365日にしました
   - 個人設定の読み込みに失敗する不具合を修正
   - スマホで見た際にヘッダーのロゴを中央寄せするようにした
   - ヘッダーのアイコンにマウスをかざした際に丸くホバーするようにした
   - 右上のサブメニュー周りの変更
     - サブメニューを閉じる際に透明な要素を置いて何もないところをクリックしたら変な所を押しちゃった、という事がないようにした
     - サブメニューが引っ込まない不具合を修正した
   - Twitter ログインの有効期限を1週間から3ヶ月に変更
     - 上の Cookie 有効期限変更のついでです
   - 絶対パスに変更しきれていなかった部分の変更
   - 全体的な速度の高速化
   - CSS レイアウト（見た目）の調整
   - 肥大化したコードを大幅に整理
   - インストーラーの微修正
   - ffmpeg.exe → ffmpeg-tvrp.exe・QSVEncC64.exe → QSVEncC64-tvrp.exe・NVEncC64.exe → NVEncC64-tvrp.exe にそれぞれ名前を変更
     - TVRemotePlus 側で他に起動している各 exe のプロセスを謝って全て kill しないための暫定処置です
   - NVEncC を 4.47 に更新
   - リリースノートを書くようにした
     - 毎回変更点が多くて作業してると何をアップデートしたか忘れるためです…
   - その他細かな不具合の修正を山程…

 - **v1.0.2** - 2019/08/30
   - ストリームの画質を向上
   - Chromecast キャスト機能の動作を修正
   - 設定が反映できない不具合を修正
   - その他不具合修正のみです

 - **v1.0.1** - 2019/08/29
   - **コメント描画、サイドメニュー開閉などの随所で使われているアニメーションの大幅な高速化**
     - フロントエンド部分は全て jQuery で書いていたのですが jQuery 自体がかなり遅く、0.5秒ごとなどに実行する処理にしては重すぎたので定期的に実行する処理はピュアJavaScriptで書き直しました
     - animate() は Velocity.js で置き換えました
     - PCだとよくわからないと思いますが、特にローエンドの Android などで今までカクついていたコメントが大分ましになっていると思います（スペックによりますが）
     - **また、プレイヤーの設定→コメントを無制限に表示 をオフにすると、生放送時で0.5秒ごとに実行するコメント取得処理時に一度に描画するコメントを8個に制限します**
       - 金曜ロードショーなど、実況勢いが200を超えるような番組で効果を発揮します
       - **低スペックPCやスマホではこの設定をオフにしておくことをお勧めします**
   - BonDriverチャンネル設定ファイル(.ch2)の取得処理の変更
     - 今まで認識出来ていた.ch2は概ね認識できると思います(思いたい)
     - **BonDriver_FSUSB2N.ch2 などのファイル名の場合、地上波用かBS・CS用か認識できません**
     - 必ず地上波用であれば BonDriver_FSUSB2N_T.ch2・BS・CS用であれば BonDriver_FSUSB2N_S.ch2 のように、ファイル名の最後に T(0-9)かS(0-9)を付けるようにしてください
   - ファイル再生画面の更新時にフェードを掛けるようにした
     - 今までより綺麗だと思います
   - Firefoxにてブックマークから開いた場合に地デジ・BS・CS切り替えタブが機能しない問題を改善
   - インストーラーで予め録画ファイルのあるフォルダを設定出来るようにした
   - Chromecast機能が動かない問題を修正
   - Chromecast機能の再生/停止関連の動作を一部修正
     - 操作の遅延が少なくなると思います
   - ファイル再生画面でリストがない場合にエラーになる問題を修正
   - ストリーム再起動が重複する問題を修正
   - その他不具合修正諸々


 - **v1.0.0** - 2019/08/27
   - **ついに正式版になりました！**（いつまでもRC版できりがなさそうなので…）
   - 環境設定設定を設定ページから変更できるようにした
     - これで config.php を一々いじる必要がなくなる他、設定ミスで文法エラーが起きることもなくなり非常に使いやすくなると思います
   - 録画ファイル増減時にリストを自動で更新するようにした
   - 地デジのチャンネルに BonDriver_*S0.dll などBSCS用BonDriverを、BSCSのチャンネルに BonDriver_*T0.dll などを表示しないようにした
     - 設定ページを作るにあたり不都合になったので一緒に修正しました
   - ストリームが途中で止まってしまった場合に20秒以上ストリームの更新がない事を検知してストリームを再起動するようにした
   - ストリーム開始して30秒以上音沙汰がなければ失敗したと判定して自動でストリーム終了するようにした
   - ファイル再生画面の画面描画時にフェードアニメーションを追加
   - ←キーで5秒巻き戻し・→キーで5秒早送り・スペースキーで再生/停止、(プレイヤーにフォーカスが当たっている状態で)↑キーで音量+・↓キーで音量- が出来るようにした
     - 実際はもっと前から出来たのですが、あまり認知されていなかったのと動作が微妙だったのでまとめて修正しました
   - Twitter ログイン時に Consumer Key 等が間違っていて認証に失敗した際にエラーメッセージを出すようにした
   - サイドメニューのバージョン欄を version 1.0.0 のように表示するようにした
   - アイコンの更新
   - その他諸々の不具合修正